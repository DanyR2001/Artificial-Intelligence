#ifndef CHESSENGINE_H
#define CHESSENGINE_H

#include <algorithm>
#include <chrono>
#include <string>

#include "chess-library/include/chess.hpp"
#include "transposition_table.h"

class ChessEngine {
 public:
  std::string computer_move_alphabeta_mvvlva(int depth);
  int search_alphabeta_mvvlva(int depth);
  chess::Movelist generate_legal_moves();
  int score_move(const chess::Move& move);
  int piece_value(chess::PieceType type);
  int search_captures(int alpha, int beta);
  int basic_evaluation();
  int search_alphabeta_mvvlva_rec(int depth, int alpha, int beta);
  void order_moves_with_tt_move(chess::Movelist& moves, chess::Move tt_move);

  ChessEngine(std::string fen);
  ChessEngine();

  chess::Board board;
  int evaluations_counter = 0;
  int cache_hits = 0;

  const int INF = 100000;

  const int PAWN_VALUE = 100;
  const int KNIGHT_VALUE = 300;
  const int BISHOP_VALUE = 300;
  const int ROOK_VALUE = 500;
  const int QUEEN_VALUE = 900;
  const int KING_VALUE = 10000;

 private:
  std::chrono::time_point<std::chrono::steady_clock> search_start_time;
  int search_time_limit;
  bool search_timed_out;
  TranspositionTable tt;

  static constexpr int PAWN_PST[64] = {
    0, 0, 0, 0, 0, 0, 0, 0,
    50, 50, 50, 50, 50, 50, 50, 50,
    10, 10, 20, 30, 30, 20, 10, 10,
    5, 5, 10, 25, 25, 10, 5, 5,
    0, 0, 0, 20, 20, 0, 0, 0,
    5, -5, -10, 0, 0, -10, -5, 5,
    5, 10, 10, -20, -20, 10, 10, 5,
    0, 0, 0, 0, 0, 0, 0, 0};

  static constexpr int KNIGHT_PST[64] = {
    -50, -40, -30, -30, -30, -30, -40, -50,
    -40, -20, 0, 0, 0, 0, -20, -40,
    -30, 0, 10, 15, 15, 10, 0, -30,
    -30, 5, 15, 20, 20, 15, 5, -30,
    -30, 0, 15, 20, 20, 15, 0, -30,
    -30, 5, 10, 15, 15, 10, 5, -30,
    -40, -20, 0, 5, 5, 0, -20, -40,
    -50, -40, -30, -30, -30, -30, -40, -50};

  static constexpr int BISHOP_PST[64] = {
    -20, -10, -10, -10, -10, -10, -10, -20,
    -10, 0, 0, 0, 0, 0, 0, -10,
    -10, 0, 5, 10, 10, 5, 0, -10,
    -10, 5, 5, 10, 10, 5, 5, -10,
    -10, 0, 10, 10, 10, 10, 0, -10,
    -10, 10, 10, 10, 10, 10, 10, -10,
    -10, 5, 0, 0, 0, 0, 5, -10,
    -20, -10, -10, -10, -10, -10, -10, -20};

  static constexpr int ROOK_PST[64] = {
    0, 0, 0, 0, 0, 0, 0, 0,
    5, 10, 10, 10, 10, 10, 10, 5,
    -5, 0, 0, 0, 0, 0, 0, -5,
    -5, 0, 0, 0, 0, 0, 0, -5,
    -5, 0, 0, 0, 0, 0, 0, -5,
    -5, 0, 0, 0, 0, 0, 0, -5,
    -5, 0, 0, 0, 0, 0, 0, -5,
    0, 0, 0, 5, 5, 0, 0, 0};

  static constexpr int QUEEN_PST[64] = {
    -20, -10, -10, -5, -5, -10, -10, -20,
    -10, 0, 0, 0, 0, 0, 0, -10,
    -10, 0, 5, 5, 5, 5, 0, -10,
    -5, 0, 5, 5, 5, 5, 0, -5,
    0, 0, 5, 5, 5, 5, 0, -5,
    -10, 5, 5, 5, 5, 5, 0, -10,
    -10, 0, 5, 0, 0, 0, 0, -10,
    -20, -10, -10, -5, -5, -10, -10, -20};

  static constexpr int KING_PST[64] = {
    -30, -40, -40, -50, -50, -40, -40, -30,
    -30, -40, -40, -50, -50, -40, -40, -30,
    -30, -40, -40, -50, -50, -40, -40, -30,
    -30, -40, -40, -50, -50, -40, -40, -30,
    -20, -30, -30, -40, -40, -30, -30, -20,
    -10, -20, -20, -20, -20, -20, -20, -10,
    20, 20, 0, 0, 0, 0, 20, 20,
    20, 30, 10, 0, 0, 10, 30, 20};

  int get_pst_value(chess::Square square, chess::Color color, const int* pst_table) const;

};

#endif  // CHESSENGINE_H